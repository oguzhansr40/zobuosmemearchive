<!DOCTYPE html>
<html lang='tr'>
<head>
<meta charset='UTF-8'>
<title>OGY MEME ARCHIVE</title>
<meta name='viewport' content='width=device-width, initial-scale=1.0'>
<link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@300;400;700&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Ubuntu',sans-serif;}
body{
  --bg:#0d1117;--text:#e4ffff;--card:#18222d;--primary:#07c2bd;--title:#0ac9c4;--scroll:#07c2bd;
  background:var(--bg);color:var(--text);transition:.3s;
}
body.light{
  --bg:#fff3e0;--text:#332920;--card:#ffe0b8;--primary:#ff8a1a;--title:#c45d00;--scroll:#ff8a1a;
}

/* Login */
#loginScreen{position:fixed;inset:0;background:#000a;display:flex;justify-content:center;align-items:center;z-index:9999;}
.login-box{background:var(--card);padding:30px;width:330px;border-radius:12px;text-align:center;border:2px solid var(--primary);}
.login-box h2{color:var(--title);margin-bottom:15px;font-size:24px;font-weight:bold;text-shadow:0 0 8px #000;}
.login-box input{width:100%;padding:12px;margin-top:10px;border:1px solid #555;border-radius:6px;background:#fff;}
.login-box button{width:100%;padding:12px;border:none;background:var(--primary);color:white;font-weight:bold;border-radius:8px;margin-top:15px;font-size:16px;cursor:pointer;}
#loginError{color:#ff4444;margin-top:8px;min-height:18px;}

/* Navbar */
.navbar{width:100%;padding:15px 25px;background:var(--card);display:flex;justify-content:space-between;align-items:center;border-bottom:3px solid var(--primary);position:sticky;top:0;z-index:50;}
.logo{font-size:22px;font-weight:bold;color:var(--title);}
.nav-icons{display:flex;gap:15px;}
.icon{
  width:40px;height:40px;border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  font-size:22px;cursor:pointer;
  background:var(--primary);color:white;
  transition:.3s;box-shadow:0 0 6px #0006;
}
.icon:hover{transform:scale(1.1);}

/* Grid */
#videoGrid{
  width:90%;
  margin:0 auto;
  padding:20px;
  display:grid;
  grid-template-columns:repeat(auto-fill, 200px);
  justify-content:center;
  gap:10px;
}

/* Card 200x350 */
.card{
  width:200px;
  height:350px;
  background:var(--card);
  border-radius:10px;
  overflow:hidden;
  position:relative;
  cursor:pointer;
  box-shadow:0 0 8px #0004;
  display:flex;
  flex-direction:column;
}
.card-img-wrap{
  width:100%;
  height:300px;
  overflow:hidden;
}
.card-img-wrap img{
  width:100%;
  height:100%;
  object-fit:cover;
}
.card-title{
  flex:1;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:4px 6px;
  font-size:14px;
  text-align:center;
  word-break:break-word;
  white-space:normal;
}

/* Menu */
.menu-btn{
  position:absolute;top:5px;right:5px;
  background:#000a;color:white;border:none;
  padding:3px 7px;border-radius:4px;cursor:pointer;z-index:10;
}
.menu-box{
  display:none;position:absolute;top:30px;right:5px;
  background:white;color:black;width:120px;
  border-radius:6px;box-shadow:0 0 10px #0008;z-index:20;
}
.menu-box button{
  background:none;border:none;width:100%;padding:8px;cursor:pointer;text-align:left;font-size:14px;
}
.menu-box button:hover{background:#eee;}

/* Popups */
#addPopup,#playPopup{display:none;position:fixed;inset:0;background:#0009;justify-content:center;align-items:center;z-index:9998;}
.popup{background:var(--card);padding:20px;border-radius:10px;width:330px;border:2px solid var(--primary);}
.popup input{width:100%;padding:10px;margin:8px 0;border-radius:6px;border:1px solid #444;background:white;}
.popup button{width:100%;padding:12px;background:var(--primary);color:white;border:none;border-radius:6px;font-weight:bold;margin-top:10px;cursor:pointer;}
#playArea video{width:100%;border-radius:10px;}

/* Scroll top */
#topBtn{position:fixed;right:20px;bottom:20px;width:45px;height:45px;background:var(--primary);border-radius:50%;color:white;font-size:20px;display:none;align-items:center;justify-content:center;cursor:pointer;}
</style>
</head>

<body class="dark">

<div id="loginScreen">
  <div class="login-box">
    <h2>OGY MEME ARCHIVE</h2>
    <input id="logUser" placeholder="KullanÄ±cÄ± adÄ±">
    <input id="logPass" type="password" placeholder="Åžifre">
    <button onclick="attemptLogin()">GiriÅŸ Yap</button>
    <p id="loginError"></p>
  </div>
</div>

<div class="navbar">
  <div class="logo">OGY MEME ARCHIVE</div>
  <div class="nav-icons">
    <div class="icon" id="themeIcon" onclick="toggleTheme()">ðŸŒ™</div>
    <div class="icon" onclick="openAddPopup()">+</div>
  </div>
</div>

<div id="videoGrid"></div>

<div id="topBtn" onclick="scrollToTop()">â¬†</div>

<div id="addPopup">
  <div class="popup">
    <h3>Video Ekle</h3>
    <input id="videoName" placeholder="Video adÄ±">
    <input id="videoFile" type="file" accept="video/*">
    <button onclick="saveVideo()">Kaydet</button>
    <button style="background:#c33" onclick="closeAddPopup()">Kapat</button>
  </div>
</div>

<div id="playPopup">
  <div class="popup" id="playArea"></div>
</div>

<script>
const loginScreen = document.getElementById("loginScreen");
const logUser = document.getElementById("logUser");
const logPass = document.getElementById("logPass");
const loginError = document.getElementById("loginError");
const videoGrid = document.getElementById("videoGrid");
const addPopup = document.getElementById("addPopup");
const playPopup = document.getElementById("playPopup");
const playArea = document.getElementById("playArea");
const videoName = document.getElementById("videoName");
const videoFile = document.getElementById("videoFile");
const topBtn = document.getElementById("topBtn");
const themeIcon = document.getElementById("themeIcon");

let db;
let currentPlayingId = null;

document.addEventListener("DOMContentLoaded",()=>{
  if(localStorage.getItem("logged")==="true") loginScreen.style.display="none";
});

function attemptLogin(){
  const u = logUser.value.trim();
  const p = logPass.value.trim();
  if(u==="ogy" && p==="1881"){
    localStorage.setItem("logged","true");
    loginScreen.style.display="none";
  }else{
    loginError.textContent="HatalÄ± giriÅŸ!";
  }
}

function toggleTheme(){
  document.body.classList.toggle("light");
  document.body.classList.toggle("dark");
  themeIcon.textContent = document.body.classList.contains("light") ? "â˜€ï¸" : "ðŸŒ™";
}

function openAddPopup(){addPopup.style.display="flex";}
function closeAddPopup(){addPopup.style.display="none";videoName.value="";videoFile.value="";}

function scrollToTop(){window.scrollTo({top:0,behavior:"smooth"});}
window.addEventListener("scroll",()=>{topBtn.style.display=window.scrollY>200?"flex":"none";});

// ESC ile video popup kapatma
document.addEventListener("keydown", (e)=>{
  if(e.key === "Escape" && playPopup.style.display === "flex"){
    closePlay();
  }
});

let req = indexedDB.open("OGY_Meme_DB",7);
req.onupgradeneeded = e=>{
  db = e.target.result;
  if(!db.objectStoreNames.contains("videos")){
    db.createObjectStore("videos",{keyPath:"id",autoIncrement:true});
  }
};
req.onsuccess = e=>{
  db = e.target.result;
  loadVideos();
};

function generateThumb(file, cb){
  const v=document.createElement("video");
  v.preload="metadata";
  v.muted=true;
  v.src=URL.createObjectURL(file);
  v.onloadedmetadata=()=>{
    const targetTime = Math.min(0.5, (v.duration||1)/2);
    v.currentTime = targetTime;
  };
  v.onseeked=()=>{
    const c=document.createElement("canvas");
    c.width=200;c.height=300;
    const ctx=c.getContext("2d");
    ctx.drawImage(v,0,0,c.width,c.height);
    const dataURL=c.toDataURL("image/jpeg",0.8);
    URL.revokeObjectURL(v.src);
    cb(dataURL);
  };
}

function saveVideo(){
  const name=videoName.value.trim();
  const file=videoFile.files[0];
  if(!name||!file) return;

  generateThumb(file, thumb=>{
    const fr=new FileReader();
    fr.onload=()=>{
      const data={title:name,video:fr.result,thumb:thumb};
      const tx=db.transaction("videos","readwrite");
      tx.objectStore("videos").add(data).onsuccess=()=>{
        closeAddPopup();
        loadVideos();
      };
    };
    fr.readAsDataURL(file);
  });
}

function loadVideos(){
  const tx=db.transaction("videos","readonly");
  const store=tx.objectStore("videos");
  const arr=[];
  store.openCursor().onsuccess=e=>{
    const c=e.target.result;
    if(c){arr.push(c.value);c.continue();}
    else{
      arr.sort((a,b)=>a.title.localeCompare(b.title));
      renderVideos(arr);
    }
  };
}

function renderVideos(list){
  videoGrid.innerHTML="";
  list.forEach(v=>{
    const card=document.createElement("div");
    card.className="card";
    card.innerHTML = `
      <button class="menu-btn">â‹®</button>
      <div class="menu-box">
        <button class="edit-btn">DÃ¼zenle</button>
        <button class="del-btn">Sil</button>
      </div>
      <div class="card-img-wrap">
        <img src="${v.thumb}" alt="">
      </div>
      <div class="card-title">${v.title}</div>
    `;

    const menuBtn = card.querySelector(".menu-btn");
    const menuBox = card.querySelector(".menu-box");
    const editBtn = card.querySelector(".edit-btn");
    const delBtn = card.querySelector(".del-btn");

    menuBtn.addEventListener("click",(ev)=>{
      ev.stopPropagation();
      menuBox.style.display = menuBox.style.display==="block"?"none":"block";
    });

    editBtn.addEventListener("click",(ev)=>{
      ev.stopPropagation();
      editVideo(v.id);
    });

    delBtn.addEventListener("click",(ev)=>{
      ev.stopPropagation();
      deleteVideo(v.id);
    });

    card.addEventListener("click",()=>{
      openVideo(v.id);
    });

    videoGrid.appendChild(card);
  });
}

function deleteVideo(id){
  const tx=db.transaction("videos","readwrite");
  tx.objectStore("videos").delete(id).onsuccess=()=>{
    if(currentPlayingId===id){
      closePlay();
    }
    loadVideos();
  };
}

function editVideo(id){
  const nn = prompt("Yeni ad:");
  if(!nn) return;
  const tx=db.transaction("videos","readwrite");
  const s=tx.objectStore("videos");
  s.get(id).onsuccess=e=>{
    const d=e.target.result;
    if(!d) return;
    d.title=nn;
    s.put(d).onsuccess=()=>loadVideos();
  };
}

function openVideo(id){
  const tx=db.transaction("videos","readonly");
  tx.objectStore("videos").get(id).onsuccess=e=>{
    const v=e.target.result;
    if(!v) return; // silindiyse aÃ§ma
    currentPlayingId=id;
    playArea.innerHTML = `
      <video controls autoplay src="${v.video}"></video>
      <button style="margin-top:10px;background:#c33" onclick="closePlay()">Kapat</button>
    `;
    playPopup.style.display="flex";
  };
}

function closePlay(){
  playPopup.style.display="none";
  playArea.innerHTML="";
  currentPlayingId=null;
}
</script>

</body>
</html>
